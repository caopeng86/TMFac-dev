<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta property="og:type" content="website" />
    <meta property="og:title" content="拼手速&抽锦鲤 |好多大牌礼品， 思南电视台新春好礼来袭！！">
    <meta property="og:description" content="好嗨哟，思南锦鲤来啦，万元大奖独宠一人！！点中10秒手速，再赢大牌礼品~">
    <!--<meta property="og:image" content="http://dev.360tianma.com/public/wxdemo/wxdemo2.jpg">-->
    <!--<meta property="og:url" content="http://dev.360tianma.com/">-->
    <title>拼手速&抽锦鲤 |好多大牌礼品， 思南电视台新春好礼来袭！！</title>
</head>
<body>
<div style="width:0px;height:0px;overflow:hidden;"><img src="http://review.360tianma.com/uploads/gamelogo.jpg"></div>
<div id="tm-upload" ></div>
<script src="/public/static/js/jquery-3.31.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="http://special.zhaopin.com/dscpro/js/sha1.js"></script>
<!--<script src="../static/js/jquery-3.31.min.js"></script>-->
<!--<script src="/public/breakpoint.js"></script>-->
<!--<script src="../transcode.js"></script>-->
<script>
    //请求前，先建立函数，TransCode函数中encrypt()是加密方法，decrypt()是解密方法，参数传入加解密的对象信息就行
    // var transcode = new TransCode();
    // //构造加解密函数
    // var postData={admin:'admin',password:'password'};//发送的信息
    //
    // var headers = transcode.headers(1);//headers参数
    // var data='Sw0xVpTGg8FCywWzlcZRKYCrwr6lRN5AJwUCAPp16jlENcSIDw\/UFAAr7BZcwyVSvnBujk+weEQhSc8MMMpSEeBp01j6H+Dr7DDx+JA\/nugzRUdU+vqz01jHmO22qxyillC6B9UoDLvv391r7AarPzu1mq39YHMZdrwkdXKDLB47pHo+Mmke1BA2sps7KBV\/0ewRgXkHJuu7HkvIz8HL3vHspmx\/KZs2omQKyLsADO\/AO4LPPZqjG\/cPuQiex80KzEwyBkTp2kS6isY71HtlVCRSkvv24n9ChD37Q0HgdwY='
    // var tmtimestamp =1548136602279
    // var tmrandomnum = '6f4jszezjbc2pnpb';
    // console.log(transcode.decrypt(data,tmtimestamp,tmrandomnum))
    // transcode.decrypt(a)
    // function ceshi(){
    //     var a = '';
    //     $.ajax({
    //         type: "post",
    //         url: "http://sxcc.360tianma.com/member/wechatpublic/getSignPackage",
    //         cache: false,  //禁用缓存
    //         sync:false,
    //         // headers: headers,
    //         data:{url:"http://app.linhaitv.com/application/cl01syxdzb_xveal/static/h5game/index.html#/"},
    //         //加密后的字符串，后台定义字段接收
    //         dataType: "json",
    //         success: function (data) {
    //             console.log(data)
    //             a = 2
    //         },error:function(){
    //         }
    //     })
    //     return a
    // }
    //
    // var ceshi1 =ceshi()
    //
    // console.log(ceshi1);
    // // $.ajax({
    // //     type: "post",
    // //     url: "http://review.360tianma.com/cl01syxdzb_xveal/userprizelog/index",
    // //     cache: false,  //禁用缓存
    // //     sync:false,
    // //     headers: headers,
    // //     data:{data:transcode.encrypt({page:1,page_size:20})},
    // //     //加密后的字符串，后台定义字段接收
    // //     dataType: "json",
    // //     success: function (data) {
    // //         var a = data.data;
    // //         transcode.decrypt(a)//此方法是解密后台传过来的信息，参数为加密后的字符串
    // //         console.log(data)
    // //         console.log(transcode.decrypt(a))
    // //     },error:function(){
    // //     }
    // // })
    // // $.ajax({
    // //     type: "get",
    // //     url: "http://review.360tianma.com/cl01syxdzb_xveal/prize/index",
    // //     cache: false,  //禁用缓存
    // //     sync:false,
    // //     headers: headers,
    // //     // data:{data:transcode.encrypt({page:1,page_size:20})},
    // //     //加密后的字符串，后台定义字段接收
    // //     dataType: "json",
    // //     success: function (data) {
    // //         var a = data.data;
    // //         transcode.decrypt(a)//此方法是解密后台传过来的信息，参数为加密后的字符串
    // //         console.log(data)
    // //         console.log(transcode.decrypt(a))
    // //     },error:function(){
    // //     }
    // // })
    // uploadcallback.filepart = function(info){ //每个切片上传成功的回调监听方法
    //     console.log(info)
    //     /*
    //         返回示例
    //         {
    //             chunk:1,  // 当前切片序数
    //             chunks:77, //总切片个数
    //             data:{}, //服务器上传成功的信息
    //             percent:"6%", //当前上传百分比
    //             tmp_file:"7.5.2.4030.exe", //当前上传文件名
    //             totalSize:"78434864",  //上传文件总大小
    //         }*/
    // }
    // uploadcallback.complete = function(info){//整个文件上传成功的回调监听方法
    //     console.log(info)
    //     /*
    //              返回示例
    //              {
    //                  chunk:77,  // 当前切片序数
    //                  chunks:77, //总切片个数
    //                  data:{}, //服务器上传成功的信息
    //                  percent:"100%", //当前上传百分比
    //                  tmp_file:"7.5.2.4030.exe", //当前上传文件名
    //                  totalSize:"78434864",  //上传文件总大小
    //              }*/
    // }





    var Href = window.location.href.split('?')[0].replace('index.html','');

    Href.indexOf('/test')>=0 ? (Href =0) : Href=Href;
    var ajax = function(){
        $.ajax({
            url: 'http://zhida.minisite.zhaopin.com/TokenHandler.ashx?cmd=GetTicket',
            type: 'get',
            dataType: "jsonp",
            jsonpCallback: "jsonp_success",
            success: function(data) {
                console.log(data)
                setWeixin(data)
            }
        })
    };
    ajax();
    window.addEventListener("hashchange",function(){
        console.log( location.href )
        ajax();
    },false)

    function setWeixin(data) {
        var _gticket = data.msg;
        var _gUrl = window.location.href;
        var _arr1 = _gticket.split('=');
        var _arr2 = [];
        for (var i = 0; i < _arr1.length; i++) {
            var s = _arr1[i].split('&')
            _arr2.push(s);
        };
        var _newticket = "jsapi_ticket=" + _arr2[1][0] + "&noncestr=" + _arr2[2][0] + "&timestamp=" + _arr2[3][0] + "&url=" + _gUrl
        var sig = hex_sha1(_newticket)
        wx.config({
            debug: false,
            appId: 'wxe60091deeb1eac11',
            timestamp: _arr2[3][0],
            nonceStr: _arr2[2][0],
            signature: sig,
            jsApiList: [
                'checkJsApi',
                'onMenuShareTimeline',
                'onMenuShareAppMessage',
                'onMenuShareQQ',
                'onMenuShareWeibo',
                'hideMenuItems',
                'showMenuItems'
            ]
        });

        wx.ready(function() {
            var wxData = {
                title:'测试标题',
                desc:'测试描述',
                link:Href,
                imgUrl:Href+'public/uploads/default_head.jpg'
            };
            wx.checkJsApi({
                jsApiList: [
                    'checkJsApi',
                    'onMenuShareTimeline',
                    'onMenuShareAppMessage',
                    'onMenuShareQQ',
                    'onMenuShareWeibo',
                    'hideMenuItems',
                    'showMenuItems'
                ],
                success: function(res) {
                    console.log(JSON.stringify(res));
                }
            });
            wx.onMenuShareAppMessage({
                title: wxData.title,
                desc: wxData.desc,
                link: wxData.link,
                imgUrl: wxData.imgUrl,
                trigger: function(res) {
                },
                success: function(res) {
                    _hmt.push(['_trackEvent', wxData.title, 'onMenuShareAppMessage']);
                },
                fail: function(res) {
                    console.log(JSON.stringify(res));
                }
            });
            wx.onMenuShareTimeline({
                title: wxData.title, // 分享标题
                link: wxData.link, // 分享链接
                imgUrl: wxData.imgUrl, // 分享图标
                success: function() {
                    _hmt.push(['_trackEvent', wxData.title, 'onMenuShareTimeline']);
                }
            });

        });
    }

</script>

</body>
</html>